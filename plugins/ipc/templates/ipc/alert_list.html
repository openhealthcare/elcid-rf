{% extends 'ipc/base.html' %}
{% block content %}

<div class="panel panel-default">
  <div class="panel-heading">
    <h1>Historic {{ alert_code }}</h1>
  </div>

  <div class="panel-body">
    <div id="series">
  </div>
</div>

<div class="panel panel-default">
  <div class="panel-heading">
    <h1>Recent {{ alert_code }} Alerts (40)</h1>
  </div>

  <div class="panel-body">

    {% for alert in alerts %}
    <div class="row {% if not alert.seen %} bg-danger {% endif %}">

      <div class="col-md-2">{{ alert.trigger_datetime }}</div>
      <div class="col-md-1">{{ alert.lab_test.lab_number }}</div>

      {% with alert.episode.patient.demographics as demographics %}
      <div class="col-md-1">
        <a class="orange-link" href="/#/patient/{{ demographics.patient_id }}/{{ alert.episode_id }}">
          {{ demographics.hospital_number }}</a>
      </div>
      <div class="col-md-1">
        <a class="orange-link" href="/#/patient/{{ demographics.patient_id }}/{{ alert.episode_id }}">
          {{ demographics.date_of_birth }}</a>
      </div>
      <div class="col-md-2">
        <a class="orange-link" href="/#/patient/{{ demographics.patient_id }}/{{ alert.episode_id }}">
          {{ demographics.name }}</a>
      </div>
      {% endwith %}
      <div class="col-md-2">
        {% with alert.episode.patient.upstreamlocation.get as location %}
        <a href="/#/ipc/ward/{{ location.ward|slugify }}/" class="orange-link">
          {{ location.ward }}
        </a>
        {{ location.room }} {{ locatoin.bed }}
        {% endwith %}
      </div>
      <div class="col-md-3">
        {% if alert.comments %}{{ alert.comments }}{% endif %}
      </div>
    </div> <!-- Row -->
    {% endfor %}

  </div>
</div> <!-- Panel -->
<script>
  c3.generate(
      {
          bindto: document.getElementById('series'),
          data: {
              columns: {{ alert_data |safe }},
              x: 'x',
              type: 'bar'
          },
          axis: {
              x: {
                  type: 'timeseries',
                  tick: { format: '%b %Y', rotate: 45}
              }
          },
          point: {
              show: false
          },
          bar: {
              width: {
                  ratio: 0.9
              }
          }
      }
  )
</script>

{% endblock %}
