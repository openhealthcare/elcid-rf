{% extends 'ipc/base.html' %}
{% load ipc %}
{% block content %}
<div class="panel panel-default">
  <div class="panel-heading">
    <h1>
      Isolation locations: Royal Free Hospital
    </h1>
  </div>

    <table class="table table-striped">

  {% for name, ward in wards.items %}
      <tr>
        <th colspan="10">
          <h2>{{ name }}</h2>
        </th>
    <tr>
      <th>Location</th>
      <th>Status</th>
      <th>Patient</th>
      <th>Admitted</th>
      <th>Organism</th>
      <th>Risk</th>
      <th>IPC Portal</th>
      <th>Actions</th>
      <th><!-- Isolation --></th>
    </tr>

    {% for patient in ward %}
    {% with patient.patient.sideroomstatus_set.get as sideroom_status %}
    <tr>
      <td>
        <a href="/#/ipc/bedboard/ward/{{ patient.ward_name }}/" class="orange-link">
          {{ patient.ward_name }}
        </a>
        {{ patient.room }}
        {{ patient.bed }}
      </td>
      <td> {{ patient.bed_status }}</td>
      {% with patient.patient.demographics as demographics %}
      <td>
        <a class="orange-link" href="/#/patient/{{ demographics.patient_id }}{% if patient.ipc_episode %}/{{patient.ipc_episode.id}}{% endif %}">{{ demographics.hospital_number }}</a>
        <a class="orange-link" href="/#/patient/{{ demographics.patient_id }}{% if patient.ipc_episode %}/{{patient.ipc_episode.id}}{% endif %}">{{ demographics.date_of_birth }}</a>
        <br />
        <a class="orange-link" href="/#/patient/{{ demographics.patient_id }}{% if patient.ipc_episode %}/{{patient.ipc_episode.id}}{% endif %}">{{ demographics.name }}</a>
      </td>
      {% endwith %}
      <td>
        {% if patient.admission_date_time %}
        {{ patient.admission_date_time }}
        {% endif %}
      </td>
      <td>
        {{ sideroom_status.admission_organism|default_if_none:"" }}
      </td>
      <td>
        {{ sideroom_status.risk_score|default_if_none:"" }}
      </td>
      <td>
        <div style="max-width:360px"><!-- TODO: NOT LIKE THIS -->
        {% if patient.patient.ipcstatus_set.get.comments %}
        {{ patient.patient.ipcstatus_set.get.comments | linebreaks }}
        {% endif %}
        </div>
      </td>
      <td>
        {{ sideroom_status.actions|default_if_none:"" }}
      </td>
      <td ng-controller="IsolationHelper as isolationHelper">
        <span ng-show="isolationHelper.init(
          '{{ patient.hospital_site_code }}',
          '{{ patient.ward_name }}',
          '{{ patient.room }}',
          '{{ patient.bed }}',
          {% if patient.isolated_bed %}{{ patient.isolated_bed.id }}{% else %}null{% endif %},
          {% if patient.isSideRoom %}1{% else %}0{% endif %}
        )">
          <span ng-hide='isolationHelper.isSideRoom'>
            <span ng-show='isolationHelper.isolated_bed_id'>
              <button ng-click='isolationHelper.unisolate()' class="btn btn-primary">
                Main Ward bed
              </button>
            </span>
            <span ng-hide='isolationHelper.isolated_bed_id'>
              <button ng-click="isolationHelper.isolate()" class="btn btn-default">
                Extra IPC bed
              </button>
            </span>
          </span>
        </span>
      </td>
    </tr>
    {% endwith %}
    {% endfor %}


  {% endfor %}
  </table>






</div> <!-- Panel -->
{% endblock %}
