{% extends "tb/base.html" %}
{% load tb_stats %}
{% load humanize %}
{% block tb_content %}
<div class="panel panel-default tb-stats">
  <div class="panel-heading">
    <div class="row">
      <div class="col-md-7">
        <h1>Clinic Activity {{ view.kwargs.year }} - Summary</h1>
        <p class="content-offset-below-10">
          Patients with appointments in {{ view.start_date.year }}
        </p>
      </div>
      <div class="col-md-5">
        {% include "tb/stats/stats_menu.html" %}
      </div>
    </div>
  </div>
  <div class="panel-body">
    <div class="row headline">
      <div class="col-md-4">
        <h1>{{ summary.number_of_appointments | intcomma }}</h1>
        <h3>Appointments</h3>
      </div>
      <div class="col-md-4">
        <h1>{{ summary.number_of_patients | intcomma  }}</h1>
        <h3>Patients</h3>
      </div>
      <div class="col-md-4">
        <h1>{{ summary.number_of_new_patients | intcomma  }}</h1>
        <h3>New patients</h3>
      </div>
    </div>
    <div class="row content-offset">
      <div class="col-md-12">
        {% category_bar_chart "Appointments" appointments_by_status.x appointments_by_status.vals %}
      </div>
    </div>
    <div class="row content-offset">
      <div class="col-md-12">
        {% three_col_table_with_percent 'Appointments by type' appointments_by_type %}
      </div>
    </div>
    <div class="row content-offset">
      <div class="col-md-12">
        <h1>MDT Review</h1>
      </div>
    </div>
    <div class="row">
      <div class="content-offset-20" id="mdt_review"></div>
      <script>
        c3.generate({
          bindto: '#mdt_review',
          data: {
            columns: {{ mdt_start_stop.vals | safe }},
            type: 'line',
            types: {'count': 'bar'},
            axes: {
              'duration': 'y2'
            },
          },
          legend: {
              show: false
          },
          axis: {
            x: {
              type: 'category',
              categories: {{ mdt_start_stop.x_axis | safe }},
              tick: {
                culling: 26,
                rotate: 75,
                multiline: false
              },
            },
            y: {
              label: {
                text: 'Count of patients',
                position: 'outer-middle'
              }
            },
            y2: {
              show: true,
              label: {
                text: 'Duration (minutes)',
                position: 'outer-middle'
              }
            }
          }
        });
      </script>
    </div>
    <div class="row content-offset">
      <div class="col-md-12">
        {% category_bar_chart "TB Dataset" elcid_review.x elcid_review.vals %}
      </div>
    </div>
    <div class="row">
      <div class="col-md-4">
        {% pie_chart "elCID Patient notes by user" users_recorded %}
      </div>
      <div class="col-md-4">
        {% pie_chart "Appointment types recorded on elCID" appointment_types_recording %}
      </div>
      <div class="col-md-4">
        <div class="row">
          <div class="col-md-12 text-center">
            <h3>Populated Panels</h3>
          </div>
        </div>
        <div class="row content-offset-20">
          <div class="col-md-12">
            <table class="table table-striped">
              {% for row in populated.items %}
              <tr>
                <td>
                  {{ row.0 }}
                </td>
                <td>
                  {{ row.1 }}
                </td>
              </tr>
              {% endfor %}
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
