<div ng-controller="TBCalendarHelper as tbCalendarHelper" class="panel panel-default">
  <div class="panel-heading">
    <h3>
      <i class="fa fa-calendar"></i> TB Calendar
      <span class="pull-right">
        <i class="fa fa-plus-circle edit pull-right pointer" ng-click="tbCalendarHelper.add()">
        </i>
      </span>
      </i>
    </h3>
  </div>
  <div patient-api target="tb_calendar" endpoint="tb_calendar" get-params="{cacheStamp: tbCalendarHelper.timeStamp}" class="panel-footer">
    <div class="content-offset-below-10" ng-repeat="calendar_section in ['Upcoming', 'Today', 'Last 30 Days']">
      <div ng-show=tb_calendar[calendar_section].length>
        <strong>[[ calendar_section ]]</strong>
        <div class="row" ng-repeat="row in tb_calendar[calendar_section]">
          <div class="col-sm-4">
            <i ng-show="row[1] === 'appointment'" class="fa fa-calendar"></i>
            <i ng-hide="row[1] === 'appointment'" class="fa fa-comments"></i>
            &nbsp;
            [[ row[0] | displayDate ]]
          </div>
          <div ng-show="row[1] === 'appointment'" class="col-sm-8">
            <div ng-repeat="upcoming_appointment in row[2]">
              [[ upcoming_appointment.derived_appointment_type ]]
              [[ upcoming_appointment.derived_clinic_resource ]]
              <span ng-show="upcoming_appointment.status_code !== 'Confirmed' && upcoming_appointment.status_code !== 'Checked Out'" class="nowrap">
                [[ upcoming_appointment.status_code ]]
              </span>
            </div>
          </div>
          <div ng-hide="row[1] === 'appointment'" class="col-sm-8">
            <span ng-show="row[1] === 'MDT'">
              [[ row[2][0].reason ]]
            </span>
            <span ng-hide="row[1] === 'MDT'">
              <span ng-show="row[2].length > 1">
                <div>
                  [[ row[1] ]]
                </div>
                <div ng-repeat="upcoming_mdt in row[2]" class="left-offset-20">
                  <a class="pointer orange-link nowrap" ng-show="upcoming_mdt.id" ng-click="tbCalendarHelper.edit(upcoming_mdt.id)">
                    [[ upcoming_mdt.reason ]]<span ng-show="!$last">,</span>
                  </a>
                  <span class="nowrap" ng-hide="upcoming_mdt.id">
                    [[ upcoming_mdt.reason ]]<span ng-show="!$last">,</span>
                  </span>
                </div>
              </span>
              <span ng-show="row[2].length === 1">
                [[ row[1] ]]
                <span ng-repeat="upcoming_mdt in row[2]">
                  <a class="pointer orange-link nowrap" ng-show="upcoming_mdt.id" ng-click="tbCalendarHelper.edit(upcoming_mdt.id)">
                    [[ upcoming_mdt.reason ]]<span ng-show="!$last">,</span>
                  </a>
                  <span class="nowrap" ng-hide="upcoming_mdt.id">
                    [[ upcoming_mdt.reason ]]<span ng-show="!$last">,</span>
                  </span>
                </span>
              </span>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
