<div ng-controller="TBCalendarHelper as tbCalendarHelper" class="panel panel-default">
  <div class="panel-heading">
    <h3>
      <i class="fa fa-calendar"></i> TB Calendar
      <span class="pull-right">
        <i class="fa fa-plus-circle edit pull-right pointer" ng-click="tbCalendarHelper.add()">
        </i>
      </span>
      </i>
    </h3>
  </div>
  <div patient-api target="tb_calendar" endpoint="tb_calendar" get-params="{cacheStamp: tbCalendarHelper.timeStamp}" class="panel-footer">
    <div ng-show="tb_calendar.appear_on_mdt.length">
      <strong>Scheduled to appear on MDT<span ng-show="tb_calendar.appear_on_mdt.length > 1">s</span></strong>
        <div ng-repeat="add_to_mdt in tb_calendar.appear_on_mdt track by $index" class="row">
          <div class="col-sm-3">
            <span ng-show="$index === 0 || tb_calendar.appear_on_mdt[$index-1].when !== tb_calendar.appear_on_mdt[$index].when" >
              [[ add_to_mdt.when | displayDate ]]
            </span>
          </div>
          <div class="col-sm-9">
            <span ng-show="!add_to_mdt.id">
              [[ add_to_mdt.reason ]]
            </span>
            <a class="pointer" ng-show="add_to_mdt.id" ng-click="tbCalendarHelper.edit(add_to_mdt)" >
              [[ add_to_mdt.reason ]]
            </a>
          </div>
        </div>
      </a>
    </div>
    <div ng-show="tb_calendar.next_appointment">
      <strong>Next Appointment</strong><br>
      <div class="row">
        <div class="col-sm-3">
          [[ tb_calendar.next_appointment.start_datetime | displayDate ]]
        </div>
        <div class="col-sm-9">
          [[ tb_calendar.next_appointment.derived_appointment_type ]]
          [[ tb_calendar.next_appointment.derived_clinic_resource ]]
        </div>
      </div>
    </div>
    <div ng-show="tb_calendar.todays_appointments.length">
      <strong>Today's Appointment<span ng-show="tb_calendar.todays_appointments.length > 1">s</span></strong>
      <span ng-repeat="tb_appointment in tb_calendar.todays_appointments track by $index">
      <div class="row">
        <div class="col-sm-3">
          [[ tb_appointment.start_datetime | hhmm ]]
        </div>
        <div class="col-sm-9">
          [[ tb_appointment.derived_appointment_type ]]
          [[ tb_appointment.derived_clinic_resource ]]
          <span class="nowrap">
            [[ tb_appointment.status_code ]]
          </span>
        </div>
      </div>
      </span>
    </div>
    <div ng-show="tb_calendar.last_appointments.length">
      <strong>Last Appointment<span ng-show="tb_calendar.last_appointments.length > 1">s</span></strong>
      <span ng-repeat="tb_appointment in tb_calendar.last_appointments track by $index">
        <div class="row">
          <div class="col-sm-3">
            [[ tb_appointment.start_datetime | displayDate ]]
          </div>
          <div class="col-sm-9">
            [[ tb_appointment.derived_appointment_type ]]
            [[ tb_appointment.derived_clinic_resource ]]
            <span class="nowrap" ng-show="tb_appointment.status_code !== 'Checked In' && tb_appointment.status_code !== 'Checked Out'">
              [[ tb_appointment.status_code ]]
            </span>
          </div>
        </div>
      </span>
    </div>
  </div>
</div>
