<div class="panel panel-default">
  <div class="panel-heading">
    <h3>
      <i class="fa fa-calendar"></i> TB Calendar
      <span class="pull-right">
        <i class="fa fa-plus-circle edit pull-right pointer" ng-click="episode.recordEditor.newItem('add_to_mdt')">
        </i>
      </span>
      </i>
    </h3>
  </div>
  <div patient-api target="tb_appointments" endpoint="tb_appointments" class="panel-footer">
    <div ng-show="tb_appointments.appear_on_mdt">
      <strong>Scheduled to appear on MDT<span ng-show="tb_appointments.appear_on_mdt.length > 1">s</span></strong>
      <a class="pointer" ng-click="episode.recordEditor.editItem('add_to_mdt', episode.add_to_mdt[$index])" ng-repeat="add_to_mdt in tb_appointments.appear_on_mdt track by $index">
      <div class="row">
        <div class="col-sm-3">
          [[ add_to_mdt.add_to_which_mdt | displayDate ]]
        </div>
        <div class="col-sm-9">
          [[ add_to_mdt.reason ]]
        </div>
      </div>
      </a>
    </div>
    <div ng-show="tb_appointments.next_appointment">
      <strong>Next Appointment</strong><br>
      <div class="row">
        <div class="col-sm-3">
          [[ tb_appointments.next_appointment.start_datetime | displayDate ]]
        </div>
        <div class="col-sm-9">
          [[ tb_appointments.next_appointment.derived_appointment_type ]]
          [[ tb_appointments.next_appointment.derived_clinic_resource ]]
        </div>
      </div>
    </div>
    <div ng-show="tb_appointments.todays_appointments.length">
      <strong>Today's Appointment<span ng-show="tb_appointments.todays_appointments.length > 1">s</span></strong>
      <span ng-repeat="tb_appointment in tb_appointments.todays_appointments track by $index">
      <div class="row">
        <div class="col-sm-3">
          [[ tb_appointment.start_datetime | hhmm ]]
        </div>
        <div class="col-sm-9">
          [[ tb_appointment.derived_appointment_type ]]
          [[ tb_appointment.derived_clinic_resource ]]
          <span class="nowrap">
            [[ tb_appointment.status_code ]]
          </span>
        </div>
      </div>
      </span>
    </div>
    <div ng-show="tb_appointments.last_appointments.length">
      <strong>Last Appointment<span ng-show="tb_appointments.last_appointments.length > 1">s</span></strong>
      <span ng-repeat="tb_appointment in tb_appointments.last_appointments track by $index">
        <div class="row">
          <div class="col-sm-3">
            [[ tb_appointment.start_datetime | displayDate ]]
          </div>
          <div class="col-sm-9">
            [[ tb_appointment.derived_appointment_type ]]
            [[ tb_appointment.derived_clinic_resource ]]
            <span class="nowrap" ng-show="tb_appointment.status_code !== 'Checked In' && tb_appointment.status_code !== 'Checked Out'">
              [[ tb_appointment.status_code ]]
            </span>
          </div>
        </div>
      </span>
    </div>
  </div>
</div>
